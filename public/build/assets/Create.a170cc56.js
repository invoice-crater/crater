import{au as Q,ay as Z,I as ee,H as te,l as ae,M as ne,m as oe,N as se,d as $,e as m,v as le,R as re,r as s,o as y,j as V,h as l,a as n,b as C,x as t,z as U,t as P,g as k,n as ie,w as ue,p as S,q as me,L as ce,am as de}from"./main.f7d24694.js";import{_ as pe}from"./ItemUnitModal.db36dc6d.js";const ve={__name:"Create",setup(_e){const a=Q(),h=Z(),v=ee(),N=te(),{t:c}=ae(),f=ne(),q=oe(),z=se(),p=$(!1),B=$(N.selectedCompanySettings.tax_per_item);let r=$(!1);a.$reset(),D();const b=m({get:()=>a.currentItem.price/100,set:e=>{a.currentItem.price=Math.round(e*100)}}),x=m({get:()=>a?.currentItem?.taxes?.map(e=>{if(e)return{...e,tax_type_id:e.id,tax_name:e.name+" ("+e.percent+"%)"}}),set:e=>{a.currentItem.taxes=e}}),g=m(()=>f.name==="items.edit"),T=m(()=>g.value?c("items.edit_item"):c("items.new_item")),E=m(()=>h.taxTypes.map(e=>({...e,tax_type_id:e.id,tax_name:e.name+" ("+e.percent+"%)"}))),L=m(()=>B.value==="YES"),A=m(()=>({currentItem:{name:{required:S.withMessage(c("validation.required"),me),minLength:S.withMessage(c("validation.name_min_length",{count:3}),ce(3))},description:{maxLength:S.withMessage(c("validation.description_maxlength"),de(65e3))}}})),u=le(A,a);async function G(){v.openModal({title:c("settings.customization.items.add_item_unit"),componentName:"ItemUnitModal",size:"sm"})}async function D(){if(r.value=!0,await a.fetchItemUnits({limit:"all"}),z.hasAbilities(re.VIEW_TAX_TYPE)&&await h.fetchTaxTypes({limit:"all"}),g.value){let e=f.params.id;await a.fetchItem(e),a.currentItem.tax_per_item===1?B.value="YES":B.value="NO"}r.value=!1}async function H(){if(u.value.currentItem.$touch(),u.value.currentItem.$invalid)return!1;p.value=!0;try{let o={id:f.params.id,...a.currentItem};a.currentItem&&a.currentItem.taxes&&(o.taxes=a.currentItem.taxes.map(d=>({tax_type_id:d.tax_type_id,amount:b.value*d.percent,percent:d.percent,name:d.name,collective_tax:0}))),await(g.value?a.updateItem:a.addItem)(o),p.value=!1,q.push("/admin/items"),e()}catch{p.value=!1;return}function e(){v.closeModal(),setTimeout(()=>{a.resetCurrentItem(),v.$reset(),u.value.$reset()},300)}}return(e,o)=>{const I=s("BaseBreadcrumbItem"),d=s("BaseBreadcrumb"),R=s("BasePageHeader"),Y=s("BaseInput"),_=s("BaseInputGroup"),j=s("BaseMoney"),w=s("BaseIcon"),F=s("BaseSelectAction"),M=s("BaseMultiselect"),O=s("BaseTextarea"),W=s("BaseButton"),X=s("BaseInputGrid"),J=s("BaseCard"),K=s("BasePage");return y(),V(K,null,{default:l(()=>[n(R,{title:T.value},{default:l(()=>[n(d,null,{default:l(()=>[n(I,{title:e.$t("general.home"),to:"dashboard"},null,8,["title"]),n(I,{title:e.$tc("items.item",2),to:"/admin/items"},null,8,["title"]),n(I,{title:T.value,to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),n(pe),C("form",{class:"grid lg:grid-cols-2 mt-6",action:"submit",onSubmit:ue(H,["prevent"])},[n(J,{class:"w-full"},{default:l(()=>[n(X,{layout:"one-column"},{default:l(()=>[n(_,{label:e.$t("items.name"),"content-loading":t(r),required:"",error:t(u).currentItem.name.$error&&t(u).currentItem.name.$errors[0].$message},{default:l(()=>[n(Y,{modelValue:t(a).currentItem.name,"onUpdate:modelValue":o[0]||(o[0]=i=>t(a).currentItem.name=i),"content-loading":t(r),invalid:t(u).currentItem.name.$error,onInput:o[1]||(o[1]=i=>t(u).currentItem.name.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","error"]),n(_,{label:e.$t("items.price"),"content-loading":t(r)},{default:l(()=>[n(j,{modelValue:b.value,"onUpdate:modelValue":o[2]||(o[2]=i=>b.value=i),"content-loading":t(r)},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),n(_,{"content-loading":t(r),label:e.$t("items.unit")},{default:l(()=>[n(M,{modelValue:t(a).currentItem.unit_id,"onUpdate:modelValue":o[3]||(o[3]=i=>t(a).currentItem.unit_id=i),"content-loading":t(r),label:"name",options:t(a).itemUnits,"value-prop":"id",placeholder:e.$t("items.select_a_unit"),searchable:"","track-by":"name"},{action:l(()=>[n(F,{onClick:G},{default:l(()=>[n(w,{name:"PlusIcon",class:"h-4 mr-2 -ml-2 text-center text-primary-400"}),U(" "+P(e.$t("settings.customization.items.add_item_unit")),1)]),_:1})]),_:1},8,["modelValue","content-loading","options","placeholder"])]),_:1},8,["content-loading","label"]),L.value?(y(),V(_,{key:0,label:e.$t("items.taxes"),"content-loading":t(r)},{default:l(()=>[n(M,{modelValue:x.value,"onUpdate:modelValue":o[4]||(o[4]=i=>x.value=i),"content-loading":t(r),options:E.value,mode:"tags",label:"tax_name",class:"w-full","value-prop":"id","can-deselect":!1,"can-clear":!1,searchable:"","track-by":"tax_name",object:""},null,8,["modelValue","content-loading","options"])]),_:1},8,["label","content-loading"])):k("",!0),n(_,{label:e.$t("items.description"),"content-loading":t(r),error:t(u).currentItem.description.$error&&t(u).currentItem.description.$errors[0].$message},{default:l(()=>[n(O,{modelValue:t(a).currentItem.description,"onUpdate:modelValue":o[5]||(o[5]=i=>t(a).currentItem.description=i),"content-loading":t(r),name:"description",row:2,rows:"2",onInput:o[6]||(o[6]=i=>t(u).currentItem.description.$touch())},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),C("div",null,[n(W,{"content-loading":t(r),type:"submit",loading:p.value},{left:l(i=>[p.value?k("",!0):(y(),V(w,{key:0,name:"SaveIcon",class:ie(i.class)},null,8,["class"]))]),default:l(()=>[U(" "+P(g.value?e.$t("items.update_item"):e.$t("items.save_item")),1)]),_:1},8,["content-loading","loading"])])]),_:1})]),_:1})],32)]),_:1})}}};export{ve as default};
