import{g as ae,am as se,i as c,u as oe,C as le,j as re,k as h,D as ne,l as ie,r as i,o as u,c as x,b as a,s as _,w as l,t as d,y as o,v as D,x as y,A as g,F as C,H as de,z as ue}from"./vendor.d8bc4b48.js";import{_ as ce}from"./EstimateIndexDropdown.16e66ecb.js";import{g as me,j as fe,u as pe,i as _e,d as ye,e as N}from"./main.90d606cc.js";import{_ as ge}from"./SendEstimateModal.3103ecb4.js";import{L as be}from"./LoadingIcon.73dcffb3.js";const ve={class:"mr-3 text-sm"},he={class:"fixed top-0 left-0 hidden h-full pt-16 pb-4 ml-56 bg-white xl:ml-64 w-88 xl:block"},xe={class:"flex items-center justify-between px-4 pt-8 pb-2 border border-gray-200 border-solid height-full"},Be={class:"mb-6"},Ee={class:"flex mb-6 ml-3",role:"group","aria-label":"First group"},ke={class:"px-4 py-1 pb-2 mb-1 mb-2 text-sm border-b border-gray-200 border-solid"},Se={key:0,class:"h-full pb-32 overflow-y-scroll border-l border-gray-200 border-solid base-scroll"},we={class:"flex-2"},Te={class:"mt-1 mb-2 text-xs not-italic font-medium leading-5 text-gray-600"},Ie={class:"flex-1 whitespace-nowrap right"},De={class:"text-sm not-italic font-normal leading-5 text-right text-gray-600 est-date"},Fe={class:"flex justify-center p-4 items-center"},$e={key:0,class:"flex justify-center px-4 mt-5 text-sm text-gray-600"},Ve={class:"flex flex-col min-h-0 mt-8 overflow-hidden",style:{height:"75vh"}},Ae=["src"],je={setup(Ce){const z=me(),m=fe();pe();const L=_e(),F=ye(),{t:p}=ae();se("$utils"),c(null),c(null);const n=c(null);c(null);const b=oe();le(),c(["DRAFT","SENT","VIEWED","EXPIRED","ACCEPTED","REJECTED"]);const S=c(!1),M=c(!1);c(!1);const $=c(!1),v=c(!1),B=c(!1),t=re({orderBy:null,orderByField:null,searchText:null}),R=h(()=>n.value.estimate_number),V=h(()=>t.orderBy==="asc"||t.orderBy==null);h(()=>V.value?p("general.ascending"):p("general.descending"));const j=h(()=>`/estimates/pdf/${n.value.unique_hash}`);h(()=>n.value&&n.value.id?estimate.value.id:null),ne(b,(e,r)=>{e.name==="estimates.view"&&A()}),U(),A(),f=ie.exports.debounce(f,500);function P(e){return b.params.id==e}async function U(){v.value=!0,await m.fetchEstimates(b.params.id),v.value=!1,setTimeout(()=>{H()},500)}function H(){const e=document.getElementById(`estimate-${b.params.id}`);e&&(e.scrollIntoView({behavior:"smooth"}),e.classList.add("shake"))}async function A(){B.value=!0;let e=await m.fetchEstimate(b.params.id);e.data&&(B.value=!1,n.value={...e.data.data})}async function f(){let e="";t.searchText!==""&&t.searchText!==null&&t.searchText!==void 0&&(e+=`search=${t.searchText}&`),t.orderBy!==null&&t.orderBy!==void 0&&(e+=`orderBy=${t.orderBy}&`),t.orderByField!==null&&t.orderByField!==void 0&&(e+=`orderByField=${t.orderByField}`),$.value=!0;let r=await m.searchEstimate(e);$.value=!1,r.data&&(m.estimates=r.data.data)}function G(){return t.orderBy==="asc"?(t.orderBy="desc",f(),!0):(t.orderBy="asc",f(),!0)}async function q(){L.openDialog({title:p("general.are_you_sure"),message:p("estimates.confirm_mark_as_sent"),yesLabel:p("general.ok"),noLabel:p("general.cancel"),variant:"primary",hideNoButton:!1,size:"lg"}).then(e=>{S.value=!1,e&&(m.markAsSent({id:n.value.id,status:"SENT"}),n.value.status="SENT",S.value=!0)})}async function J(e){z.openModal({title:p("estimates.send_estimate"),componentName:"SendEstimateModal",id:n.value.id,data:n.value})}return(e,r)=>{const E=i("BaseButton"),O=i("BasePageHeader"),k=i("BaseIcon"),W=i("BaseInput"),w=i("BaseRadio"),T=i("BaseInputGroup"),I=i("BaseDropdownItem"),X=i("BaseDropdown"),K=i("BaseText"),Q=i("BaseEstimateStatusBadge"),Y=i("BaseFormatMoney"),Z=i("router-link"),ee=i("BasePage");return u(),x(C,null,[a(ge),n.value?(u(),_(ee,{key:0,class:"xl:pl-96 xl:ml-8"},{default:l(()=>[a(O,{title:o(R)},{actions:l(()=>[d("div",ve,[n.value.status==="DRAFT"&&o(F).hasAbilities(o(N).EDIT_ESTIMATE)?(u(),_(E,{key:0,disabled:S.value,"content-loading":B.value,variant:"primary-outline",onClick:q},{default:l(()=>[D(y(e.$t("estimates.mark_as_sent")),1)]),_:1},8,["disabled","content-loading"])):g("",!0)]),n.value.status==="DRAFT"&&o(F).hasAbilities(o(N).SEND_ESTIMATE)?(u(),_(E,{key:0,disabled:M.value,"content-loading":B.value,variant:"primary",class:"text-sm",onClick:J},{default:l(()=>[D(y(e.$t("estimates.send_estimate")),1)]),_:1},8,["disabled","content-loading"])):g("",!0),a(ce,{class:"ml-3",row:n.value},null,8,["row"])]),_:1},8,["title"]),d("div",he,[d("div",xe,[d("div",Be,[a(W,{modelValue:o(t).searchText,"onUpdate:modelValue":r[0]||(r[0]=s=>o(t).searchText=s),placeholder:e.$t("general.search"),type:"text",variant:"gray",onInput:r[1]||(r[1]=s=>f())},{right:l(()=>[a(k,{name:"SearchIcon",class:"text-gray-400"})]),_:1},8,["modelValue","placeholder"])]),d("div",Ee,[a(X,{class:"ml-3",position:"bottom-start","width-class":"w-45","position-class":"left-0"},{activator:l(()=>[a(E,{size:"md",variant:"gray"},{default:l(()=>[a(k,{name:"FilterIcon"})]),_:1})]),default:l(()=>[d("div",ke,y(e.$t("general.sort_by")),1),a(I,{class:"flex px-4 py-2 cursor-pointer"},{default:l(()=>[a(T,{class:"-mt-3 font-normal"},{default:l(()=>[a(w,{id:"filter_estimate_date",modelValue:o(t).orderByField,"onUpdate:modelValue":[r[2]||(r[2]=s=>o(t).orderByField=s),f],label:e.$t("reports.estimates.estimate_date"),size:"sm",name:"filter",value:"estimate_date"},null,8,["modelValue","label"])]),_:1})]),_:1}),a(I,{class:"flex px-4 py-2 cursor-pointer"},{default:l(()=>[a(T,{class:"-mt-3 font-normal"},{default:l(()=>[a(w,{id:"filter_due_date",modelValue:o(t).orderByField,"onUpdate:modelValue":[r[3]||(r[3]=s=>o(t).orderByField=s),f],label:e.$t("estimates.due_date"),value:"expiry_date",size:"sm",name:"filter"},null,8,["modelValue","label"])]),_:1})]),_:1}),a(I,{class:"flex px-4 py-2 cursor-pointer"},{default:l(()=>[a(T,{class:"-mt-3 font-normal"},{default:l(()=>[a(w,{id:"filter_estimate_number",modelValue:o(t).orderByField,"onUpdate:modelValue":[r[4]||(r[4]=s=>o(t).orderByField=s),f],label:e.$t("estimates.estimate_number"),value:"estimate_number",size:"sm",name:"filter"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),a(E,{class:"ml-1",size:"md",variant:"gray",onClick:G},{default:l(()=>[o(V)?(u(),_(k,{key:0,name:"SortAscendingIcon"})):(u(),_(k,{key:1,name:"SortDescendingIcon"}))]),_:1})])]),o(m)&&o(m).estimates?(u(),x("div",Se,[(u(!0),x(C,null,de(o(m).estimates,(s,te)=>(u(),x("div",{key:te},[s&&!v.value?(u(),_(Z,{key:0,id:"estimate-"+s.id,to:`/admin/estimates/${s.id}/view`,class:ue(["flex justify-between side-estimate p-4 cursor-pointer hover:bg-gray-100 items-center border-l-4 border-transparent",{"bg-gray-100 border-l-4 border-primary-500 border-solid":P(s.id)}]),style:{"border-bottom":"1px solid rgba(185, 193, 209, 0.41)"}},{default:l(()=>[d("div",we,[a(K,{text:s.customer.name,length:30,class:"pr-2 mb-2 text-sm not-italic font-normal leading-5 text-black capitalize truncate"},null,8,["text"]),d("div",Te,y(s.estimate_number),1),a(Q,{status:s.status,class:"px-1 text-xs"},{default:l(()=>[D(y(s.status),1)]),_:2},1032,["status"])]),d("div",Ie,[a(Y,{amount:s.total,currency:s.customer.currency,class:"block mb-2 text-xl not-italic font-semibold leading-8 text-right text-gray-900"},null,8,["amount","currency"]),d("div",De,y(s.formatted_estimate_date),1)])]),_:2},1032,["id","to","class"])):g("",!0)]))),128)),d("div",Fe,[v.value?(u(),_(be,{key:0,class:"h-6 m-1 animate-spin text-primary-400"})):g("",!0)]),!o(m).estimates.length&&!v.value?(u(),x("p",$e,y(e.$t("estimates.no_matching_estimates")),1)):g("",!0)])):g("",!0)]),d("div",Ve,[d("iframe",{src:`${o(j)}`,class:"flex-1 border border-gray-400 border-solid rounded-md bg-white frame-style"},null,8,Ae)])]),_:1})):g("",!0)],64)}}};export{je as default};
