import{ad as x,r as o,o as c,c as L,a,x as t,h as n,az as A,H as O,ai as X,l as Y,d as S,M as J,m as K,e as v,p as _,q as w,am as Q,ak as W,X as Z,v as ee,E as te,j as E,g as C,b,t as I,n as ae,z as se,w as ie,F as ne}from"./main.f7d24694.js";import{_ as oe,a as le,b as re,c as me,d as de,e as ue,f as ce}from"./SalesTax.b592bd30.js";import{_ as ge}from"./CreateCustomFields.9b9a4722.js";import{_ as pe}from"./ExchangeRateConverter.21f92bb1.js";import{_ as _e}from"./TaxTypeModal.ed2661a5.js";import"./DragIcon.8c2071fa.js";import"./SelectNotePopup.611ea1c0.js";import"./NoteModal.0ea37fc5.js";import"./payment.a31e4924.js";import"./exchange-rate.ddcf1ef1.js";const fe={class:"md:grid-cols-12 grid-cols-1 md:gap-x-6 mt-6 mb-8 grid gap-y-5"},ve={__name:"EstimateCreateBasicFields",props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(s){const e=x();return(f,l)=>{const B=o("BaseCustomerSelectPopup"),r=o("BaseDatePicker"),d=o("BaseInputGroup"),$=o("BaseInput"),h=o("BaseInputGrid");return c(),L("div",fe,[a(B,{modelValue:t(e).newEstimate.customer,"onUpdate:modelValue":l[0]||(l[0]=m=>t(e).newEstimate.customer=m),valid:s.v.customer_id,"content-loading":s.isLoading,type:"estimate",class:"col-span-5 pr-0"},null,8,["modelValue","valid","content-loading"]),a(h,{class:"col-span-7"},{default:n(()=>[a(d,{label:f.$t("reports.estimates.estimate_date"),"content-loading":s.isLoading,required:"",error:s.v.estimate_date.$error&&s.v.estimate_date.$errors[0].$message},{default:n(()=>[a(r,{modelValue:t(e).newEstimate.estimate_date,"onUpdate:modelValue":l[1]||(l[1]=m=>t(e).newEstimate.estimate_date=m),"content-loading":s.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),a(d,{label:f.$t("estimates.expiry_date"),"content-loading":s.isLoading},{default:n(()=>[a(r,{modelValue:t(e).newEstimate.expiry_date,"onUpdate:modelValue":l[2]||(l[2]=m=>t(e).newEstimate.expiry_date=m),"content-loading":s.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),a(d,{label:f.$t("estimates.estimate_number"),"content-loading":s.isLoading,required:"",error:s.v.estimate_number.$error&&s.v.estimate_number.$errors[0].$message},{default:n(()=>[a($,{modelValue:t(e).newEstimate.estimate_number,"onUpdate:modelValue":l[3]||(l[3]=m=>t(e).newEstimate.estimate_number=m),"content-loading":s.isLoading},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),a(pe,{store:t(e),"store-prop":"newEstimate",v:s.v,"is-loading":s.isLoading,"is-edit":s.isEdit,"customer-currency":t(e).newEstimate.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])]),_:1})])}}},Ee={class:"flex"},ye={class:"block mt-10 estimate-foot lg:flex lg:justify-between lg:items-start"},we={class:"relative w-full lg:w-1/2"},k="newEstimate",xe={__name:"EstimateCreate",setup(s){const e=x(),f=A(),l=O(),B=X(),{t:r}=Y();let d=S(!1);const $=S(!1),h=S(["customer","company","customerCustom","estimate","estimateCustom"]);let m=J(),M=K(),g=v(()=>e.isFetchingInitialSettings),P=v(()=>p.value?r("estimates.edit_estimate"):r("estimates.new_estimate")),p=v(()=>m.name==="estimates.edit");const F=v(()=>l.selectedCompanySettings.sales_tax_us_enabled==="YES"&&f.salesTaxUSEnabled),T={estimate_date:{required:_.withMessage(r("validation.required"),w)},estimate_number:{required:_.withMessage(r("validation.required"),w)},reference_number:{maxLength:_.withMessage(r("validation.price_maxlength"),Q(255))},customer_id:{required:_.withMessage(r("validation.required"),w)},exchange_rate:{required:W(function(){return _.withMessage(r("validation.required"),w),e.showExchangeRate}),decimal:_.withMessage(r("validation.valid_exchange_rate"),Z)}},y=ee(T,v(()=>e.newEstimate),{$scope:k});te(()=>e.newEstimate.customer,i=>{i&&i.currency?e.newEstimate.selectedCurrency=i.currency:e.newEstimate.selectedCurrency=l.selectedCompanyCurrency}),e.resetCurrentEstimate(),B.resetCustomFields(),y.value.$reset,e.fetchEstimateInitialSettings(p.value);async function N(){if(y.value.$touch(),y.value.$invalid)return!1;d.value=!0;let i={...e.newEstimate,sub_total:e.getSubTotal,total:e.getTotal,tax:e.getTotalTax};const V=p.value?e.updateEstimate:e.addEstimate;try{let u=await V(i);u.data.data&&M.push(`/admin/estimates/${u.data.data.id}/view`)}catch(u){console.error(u)}d.value=!1}return(i,V)=>{const u=o("BaseBreadcrumbItem"),U=o("BaseBreadcrumb"),q=o("BaseButton"),D=o("router-link"),G=o("BaseIcon"),j=o("BasePageHeader"),z=o("BaseScrollPane"),H=o("BasePage");return c(),L(ne,null,[a(oe),a(le),a(_e),F.value&&(!t(g)||t(m).query.customer)?(c(),E(re,{key:0,store:t(e),"store-prop":"newEstimate","is-edit":t(p),customer:t(e).newEstimate.customer},null,8,["store","is-edit","customer"])):C("",!0),a(H,{class:"relative estimate-create-page"},{default:n(()=>[b("form",{onSubmit:ie(N,["prevent"])},[a(j,{title:t(P)},{actions:n(()=>[i.$route.name==="estimates.edit"?(c(),E(D,{key:0,to:`/estimates/pdf/${t(e).newEstimate.unique_hash}`,target:"_blank"},{default:n(()=>[a(q,{class:"mr-3",variant:"primary-outline",type:"button"},{default:n(()=>[b("span",Ee,I(i.$t("general.view_pdf")),1)]),_:1})]),_:1},8,["to"])):C("",!0),a(q,{loading:t(d),disabled:t(d),"content-loading":t(g),variant:"primary",type:"submit"},{left:n(R=>[t(d)?C("",!0):(c(),E(G,{key:0,class:ae(R.class),name:"SaveIcon"},null,8,["class"]))]),default:n(()=>[se(" "+I(i.$t("estimates.save_estimate")),1)]),_:1},8,["loading","disabled","content-loading"])]),default:n(()=>[a(U,null,{default:n(()=>[a(u,{title:i.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),a(u,{title:i.$tc("estimates.estimate",2),to:"/admin/estimates"},null,8,["title"]),i.$route.name==="estimates.edit"?(c(),E(u,{key:0,title:i.$t("estimates.edit_estimate"),to:"#",active:""},null,8,["title"])):(c(),E(u,{key:1,title:i.$t("estimates.new_estimate"),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),a(ve,{v:t(y),"is-loading":t(g),"is-edit":t(p)},null,8,["v","is-loading","is-edit"]),a(z,null,{default:n(()=>[a(me,{currency:t(e).newEstimate.selectedCurrency,"is-loading":t(g),"item-validation-scope":k,store:t(e),"store-prop":"newEstimate"},null,8,["currency","is-loading","store"]),b("div",ye,[b("div",we,[a(de,{store:t(e),"store-prop":"newEstimate",fields:h.value,type:"Estimate"},null,8,["store","fields"]),a(ge,{type:"Estimate","is-edit":t(p),"is-loading":t(g),store:t(e),"store-prop":"newEstimate","custom-field-scope":k,class:"mb-6"},null,8,["is-edit","is-loading","store"]),a(ue,{store:t(e),"component-name":"EstimateTemplate","store-prop":"newEstimate","is-mark-as-default":$.value},null,8,["store","is-mark-as-default"])]),a(ce,{currency:t(e).newEstimate.selectedCurrency,"is-loading":t(g),store:t(e),"store-prop":"newEstimate","tax-popup-type":"estimate"},null,8,["currency","is-loading","store"])])]),_:1})],32)]),_:1})],64)}}};export{xe as default};
