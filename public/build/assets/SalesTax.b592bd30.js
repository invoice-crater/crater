import{ay as H,I as Q,N as oe,d as Y,K as pe,a5 as ne,l as W,e as I,E as ae,r as x,o as n,c as $,b as a,t as _,a as s,a6 as $e,x as p,h as i,z as V,j as M,g as U,H as K,au as ye,M as we,P as X,p as N,q as F,aI as me,am as ee,aA as Se,v as re,F as G,i as Z,R as le,aK as Be,ar as xe,a8 as Ie,aL as Te,n as R,O as ke,aM as Pe,aN as Ce,ad as Me,u as Ae,L as De,f as fe,w as _e,J as Ve}from"./main.f7d24694.js";import{D as je,d as qe}from"./DragIcon.8c2071fa.js";import{_ as Ue}from"./SelectNotePopup.611ea1c0.js";const Ne={class:"flex items-center justify-between mb-3"},Ee={class:"flex items-center text-base",style:{flex:"4"}},Oe={class:"pr-2 mb-0",align:"right"},Le={class:"absolute left-3.5"},ze={class:"ml-2 text-sm leading-none cursor-pointer text-primary-400"},Fe=a("br",null,null,-1),Re={class:"text-sm text-right",style:{flex:"3"}},Ye={class:"flex items-center justify-center w-6 h-10 mx-2 cursor-pointer"},Xe={__name:"CreateItemRowTax",props:{ability:{type:String,default:""},store:{type:Object,default:null},storeProp:{type:String,default:""},itemIndex:{type:Number,required:!0},index:{type:Number,required:!0},taxData:{type:Object,required:!0},taxes:{type:Array,default:[]},total:{type:Number,default:0},totalTax:{type:Number,default:0},discountedTotal:{type:Number,default:0},currency:{type:[Object,String],required:!0},updateItems:{type:Function,default:()=>{}}},emits:["remove","update"],setup(t,{emit:f}){const e=t,o=f,w=H(),b=Q(),c=oe(),S=Y(null),B=pe({...e.taxData});ne("utils");const{t:y}=W(),A=I(()=>w.taxTypes.map(g=>({...g})).map(g=>(e.taxes.find(r=>r.tax_type_id===g.id)?g.disabled=!0:g.disabled=!1,g))),D=I(()=>B.compound_tax&&e.discountedTotal?(e.discountedTotal+e.totalTax)*B.percent/100:e.discountedTotal&&B.percent?e.discountedTotal*B.percent/100:0);ae(()=>e.discountedTotal,()=>{l()}),ae(()=>e.totalTax,()=>{l()}),e.taxData.tax_type_id>0&&(S.value=w.taxTypes.find(m=>m.id===e.taxData.tax_type_id)),l();function j(m){B.percent=m.percent,B.tax_type_id=m.id,B.compound_tax=m.compound_tax,B.name=m.name,l()}function l(){B.tax_type_id!==0&&o("update",{index:e.index,item:{...B,amount:D.value}})}function u(){let m={itemIndex:e.itemIndex,taxIndex:e.index};b.openModal({title:y("settings.tax_types.add_tax"),componentName:"TaxTypeModal",data:m,size:"sm"})}function d(m){e.store.$patch(g=>{g[e.storeProp].items[e.itemIndex].taxes.splice(m,1)})}return(m,g)=>{const h=x("BaseIcon"),r=x("BaseMultiselect"),T=x("BaseFormatMoney");return n(),$("div",Ne,[a("div",Ee,[a("label",Oe,_(m.$t("invoices.item.tax")),1),s(r,{modelValue:S.value,"onUpdate:modelValue":[g[0]||(g[0]=k=>S.value=k),g[1]||(g[1]=k=>j(k))],"value-prop":"id",options:A.value,placeholder:m.$t("general.select_a_tax"),"open-direction":"top","track-by":"name",searchable:"",object:"",label:"name"},$e({singlelabel:i(({value:k})=>[a("div",Le,_(k.name)+" - "+_(k.percent)+" % ",1)]),option:i(({option:k})=>[V(_(k.name)+" - "+_(k.percent)+" % ",1)]),_:2},[p(c).hasAbilities(t.ability)?{name:"action",fn:i(()=>[a("button",{type:"button",class:"flex items-center justify-center w-full px-2 py-2 bg-gray-200 border-none outline-none cursor-pointer",onClick:u},[s(h,{name:"CheckCircleIcon",class:"h-5 text-primary-400"}),a("label",ze,_(m.$t("invoices.add_new_tax")),1)])]),key:"0"}:void 0]),1032,["modelValue","options","placeholder"]),Fe]),a("div",Re,[s(T,{amount:D.value,currency:t.currency},null,8,["amount","currency"])]),a("div",Ye,[t.taxes.length&&t.index!==t.taxes.length-1?(n(),M(h,{key:0,name:"TrashIcon",class:"h-5 text-gray-700 cursor-pointer",onClick:g[2]||(g[2]=k=>d(t.index))})):U("",!0)])])}}},Qe={class:"box-border bg-white border border-gray-200 border-solid rounded-b"},We={colspan:"5",class:"p-0 text-left align-top"},Je={class:"w-full"},Ge=a("col",{style:{width:"40%","min-width":"280px"}},null,-1),Ze=a("col",{style:{width:"10%","min-width":"120px"}},null,-1),He=a("col",{style:{width:"15%","min-width":"120px"}},null,-1),Ke={key:0,style:{width:"15%","min-width":"160px"}},et=a("col",{style:{width:"15%","min-width":"120px"}},null,-1),tt={class:"px-5 py-4 text-left align-top"},st={class:"flex justify-start"},at={class:"flex items-center justify-center w-5 h-5 mt-2 mr-2 text-gray-300 cursor-move handle"},ot={class:"px-5 py-4 text-right align-top"},nt={class:"px-5 py-4 text-left align-top"},rt={class:"flex flex-col"},lt={class:"flex-auto flex-fill bd-highlight"},it={class:"relative w-full"},dt={key:0,class:"px-5 py-4 text-left align-top"},ct={class:"flex flex-col"},ut={class:"flex",style:{width:"120px"},role:"group"},mt={class:"flex items-center"},pt={class:"px-5 py-4 text-right align-top"},yt={class:"flex items-center justify-end text-sm"},xt={class:"flex items-center justify-center w-6 h-10 mx-2"},ft={key:0},_t=a("td",{class:"px-5 py-4 text-left align-top"},null,-1),gt={colspan:"4",class:"px-5 py-4 text-left align-top"},ht={__name:"CreateItemRow",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},itemData:{type:Object,default:null},index:{type:Number,default:null},type:{type:String,default:""},loading:{type:Boolean,default:!1},currency:{type:[Object,String],required:!0},invoiceItems:{type:Array,required:!0},itemValidationScope:{type:String,default:""}},emits:["update","remove","itemValidate"],setup(t,{emit:f}){const e=t,o=K(),w=ye();we();const{t:b}=W(),c=I({get:()=>e.itemData.quantity,set:v=>{q("quantity",parseFloat(v))}}),S=I({get:()=>{const v=e.itemData.price;return parseFloat(v)>0?v/100:v},set:v=>{if(parseFloat(v)>0){let C=Math.round(v*100);q("price",C)}else q("price",v)}}),B=I(()=>e.itemData.price*e.itemData.quantity),y=I({get:()=>e.itemData.discount,set:v=>{e.itemData.discount_type==="percentage"?q("discount_val",B.value*v/100):q("discount_val",Math.round(v*100)),q("discount",v)}}),A=I(()=>B.value-e.itemData.discount_val),D=I(()=>e.currency?e.currency:o.selectedCompanyCurrency),j=I(()=>e.store[e.storeProp].items.length!=1),l=I(()=>Math.round(X.exports.sumBy(e.itemData.taxes,function(v){return v.compound_tax?0:v.amount}))),u=I(()=>Math.round(X.exports.sumBy(e.itemData.taxes,function(v){return v.compound_tax?v.amount:0}))),d=I(()=>l.value+u.value),m={name:{required:N.withMessage(b("validation.required"),F)},quantity:{required:N.withMessage(b("validation.required"),F),minValue:N.withMessage(b("validation.qty_must_greater_than_zero"),me(0)),maxLength:N.withMessage(b("validation.amount_maxlength"),ee(20))},price:{required:N.withMessage(b("validation.required"),F),minValue:N.withMessage(b("validation.number_length_minvalue"),me(1)),maxLength:N.withMessage(b("validation.price_maxlength"),ee(20))},discount_val:{between:N.withMessage(b("validation.discount_maxlength"),Se(0,I(()=>B.value)))},description:{maxLength:N.withMessage(b("validation.notes_maxlength"),ee(65e3))}},g=re(m,I(()=>e.store[e.storeProp].items[e.index]),{$scope:e.itemValidationScope});function h(v){e.store.$patch(L=>{L[e.storeProp].items[e.index].taxes[v.index]=v.item}),e.itemData.taxes[e.itemData.taxes.length-1]?.tax_type_id!==0&&e.store.$patch(L=>{L[e.storeProp].items[e.index].taxes.push({...Be,id:xe.raw()})}),P()}function r(v){q("name",v)}function T(v){e.store.$patch(C=>{if(C[e.storeProp].items[e.index].name=v.name,C[e.storeProp].items[e.index].price=v.price,C[e.storeProp].items[e.index].item_id=v.id,C[e.storeProp].items[e.index].description=v.description,v.unit&&(C[e.storeProp].items[e.index].unit_name=v.unit.name),e.store[e.storeProp].tax_per_item==="YES"&&v.taxes){let L=0;v.taxes.forEach(J=>{h({index:L,item:{...J}}),L++})}C[e.storeProp].exchange_rate&&(C[e.storeProp].items[e.index].price/=C[e.storeProp].exchange_rate)}),w.fetchItems(),P()}function k(){e.itemData.discount_type!=="fixed"&&(q("discount_val",Math.round(e.itemData.discount*100)),q("discount_type","fixed"))}function O(){e.itemData.discount_type!=="percentage"&&(q("discount_val",B.value*e.itemData.discount/100),q("discount_type","percentage"))}function P(){let v=e.store[e.storeProp]?.items[e.index]?.taxes;v||(v=[]);let C={...e.store[e.storeProp].items[e.index],index:e.index,total:A.value,sub_total:B.value,totalSimpleTax:l.value,totalCompoundTax:u.value,totalTax:d.value,tax:d.value,taxes:[...v]};e.store.updateItem(C)}function q(v,C){e.store.$patch(L=>{L[e.storeProp].items[e.index][v]=C}),P()}return(v,C)=>{const L=x("BaseItemSelect"),J=x("BaseInput"),E=x("BaseMoney"),ie=x("BaseIcon"),ge=x("BaseButton"),de=x("BaseDropdownItem"),he=x("BaseDropdown"),ce=x("BaseContentPlaceholdersText"),ue=x("BaseContentPlaceholders"),ve=x("BaseFormatMoney");return n(),$("tr",Qe,[a("td",We,[a("table",Je,[a("colgroup",null,[Ge,Ze,He,t.store[t.storeProp].discount_per_item==="YES"?(n(),$("col",Ke)):U("",!0),et]),a("tbody",null,[a("tr",null,[a("td",tt,[a("div",st,[a("div",at,[s(je)]),s(L,{type:"Invoice",item:t.itemData,invalid:p(g).name.$error,"invalid-description":p(g).description.$error,taxes:t.itemData.taxes,index:t.index,"store-prop":t.storeProp,store:t.store,onSearch:r,onSelect:T},null,8,["item","invalid","invalid-description","taxes","index","store-prop","store"])])]),a("td",ot,[s(J,{modelValue:c.value,"onUpdate:modelValue":C[0]||(C[0]=z=>c.value=z),invalid:p(g).quantity.$error,"content-loading":t.loading,type:"number",small:"",min:"0",step:"any",onChange:C[1]||(C[1]=z=>P()),onInput:C[2]||(C[2]=z=>p(g).quantity.$touch())},null,8,["modelValue","invalid","content-loading"])]),a("td",nt,[a("div",rt,[a("div",lt,[a("div",it,[(n(),M(E,{key:D.value,modelValue:S.value,"onUpdate:modelValue":C[3]||(C[3]=z=>S.value=z),invalid:p(g).price.$error,"content-loading":t.loading,currency:D.value},null,8,["modelValue","invalid","content-loading","currency"]))])])])]),t.store[t.storeProp].discount_per_item==="YES"?(n(),$("td",dt,[a("div",ct,[a("div",ut,[s(J,{modelValue:y.value,"onUpdate:modelValue":C[4]||(C[4]=z=>y.value=z),invalid:p(g).discount_val.$error,"content-loading":t.loading,class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-br-sm h-[38px]"},null,8,["modelValue","invalid","content-loading"]),s(he,{position:"bottom-end"},{activator:i(()=>[s(ge,{"content-loading":t.loading,class:"rounded-tr-md rounded-br-md !p-2 rounded-none",type:"button",variant:"white"},{default:i(()=>[a("span",mt,[V(_(t.itemData.discount_type=="fixed"?t.currency.symbol:"%")+" ",1),s(ie,{name:"ChevronDownIcon",class:"w-4 h-4 ml-1 text-gray-500"})])]),_:1},8,["content-loading"])]),default:i(()=>[s(de,{onClick:k},{default:i(()=>[V(_(v.$t("general.fixed")),1)]),_:1}),s(de,{onClick:O},{default:i(()=>[V(_(v.$t("general.percentage")),1)]),_:1})]),_:1})])])])):U("",!0),a("td",pt,[a("div",yt,[a("span",null,[t.loading?(n(),M(ue,{key:0},{default:i(()=>[s(ce,{lines:1,class:"w-16 h-5"})]),_:1})):(n(),M(ve,{key:1,amount:A.value,currency:D.value},null,8,["amount","currency"]))]),a("div",xt,[j.value?(n(),M(ie,{key:0,class:"h-5 text-gray-700 cursor-pointer",name:"TrashIcon",onClick:C[5]||(C[5]=z=>t.store.removeItem(t.index))})):U("",!0)])])])]),t.store[t.storeProp].tax_per_item==="YES"?(n(),$("tr",ft,[_t,a("td",gt,[t.loading?(n(),M(ue,{key:0},{default:i(()=>[s(ce,{lines:1,class:"w-24 h-8 border rounded-md"})]),_:1})):(n(!0),$(G,{key:1},Z(t.itemData.taxes,(z,be)=>(n(),M(Xe,{key:z.id,index:be,"item-index":t.index,"tax-data":z,taxes:t.itemData.taxes,"discounted-total":A.value,"total-tax":l.value,total:B.value,currency:t.currency,"update-items":P,ability:p(le).CREATE_INVOICE,store:t.store,"store-prop":t.storeProp,discount:y.value,onUpdate:h},null,8,["index","item-index","tax-data","taxes","discounted-total","total-tax","total","currency","ability","store","store-prop","discount"]))),128))])])):U("",!0)])])])])}}},vt={class:"text-center item-table min-w-full"},bt=a("col",{style:{width:"40%","min-width":"280px"}},null,-1),$t=a("col",{style:{width:"10%","min-width":"120px"}},null,-1),wt=a("col",{style:{width:"15%","min-width":"120px"}},null,-1),St={key:0,style:{width:"15%","min-width":"160px"}},Bt=a("col",{style:{width:"15%","min-width":"120px"}},null,-1),It={class:"bg-white border border-gray-200 border-solid"},Tt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},kt={key:1,class:"pl-7"},Pt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},Ct={key:1},Mt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},At={key:1},Dt={key:0,class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},Vt={key:1},jt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},qt={key:1,class:"pr-10 column-heading"},Ls={__name:"CreateItems",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},currency:{type:[Object,String,null],required:!0},isLoading:{type:Boolean,default:!1},itemValidationScope:{type:String,default:""}},setup(t){const f=t,e=K(),o=I(()=>f.currency?f.currency:e.selectedCompanyCurrency);return(w,b)=>{const c=x("BaseContentPlaceholdersText"),S=x("BaseContentPlaceholders"),B=x("BaseIcon");return n(),$(G,null,[a("table",vt,[a("colgroup",null,[bt,$t,wt,t.store[t.storeProp].discount_per_item==="YES"?(n(),$("col",St)):U("",!0),Bt]),a("thead",It,[a("tr",null,[a("th",Tt,[t.isLoading?(n(),M(S,{key:0},{default:i(()=>[s(c,{lines:1,class:"w-16 h-5"})]),_:1})):(n(),$("span",kt,_(w.$tc("items.item",2)),1))]),a("th",Pt,[t.isLoading?(n(),M(S,{key:0},{default:i(()=>[s(c,{lines:1,class:"w-16 h-5"})]),_:1})):(n(),$("span",Ct,_(w.$t("invoices.item.quantity")),1))]),a("th",Mt,[t.isLoading?(n(),M(S,{key:0},{default:i(()=>[s(c,{lines:1,class:"w-16 h-5"})]),_:1})):(n(),$("span",At,_(w.$t("invoices.item.price")),1))]),t.store[t.storeProp].discount_per_item==="YES"?(n(),$("th",Dt,[t.isLoading?(n(),M(S,{key:0},{default:i(()=>[s(c,{lines:1,class:"w-16 h-5"})]),_:1})):(n(),$("span",Vt,_(w.$t("invoices.item.discount")),1))])):U("",!0),a("th",jt,[t.isLoading?(n(),M(S,{key:0},{default:i(()=>[s(c,{lines:1,class:"w-16 h-5"})]),_:1})):(n(),$("span",qt,_(w.$t("invoices.item.amount")),1))])])]),s(p(qe),{modelValue:t.store[t.storeProp].items,"onUpdate:modelValue":b[0]||(b[0]=y=>t.store[t.storeProp].items=y),"item-key":"id",tag:"tbody",handle:".handle"},{item:i(({element:y,index:A})=>[(n(),M(ht,{key:y.id,index:A,"item-data":y,loading:t.isLoading,currency:o.value,"item-validation-scope":t.itemValidationScope,"invoice-items":t.store[t.storeProp].items,store:t.store,"store-prop":t.storeProp},null,8,["index","item-data","loading","currency","item-validation-scope","invoice-items","store","store-prop"]))]),_:1},8,["modelValue"])]),a("div",{class:"flex items-center justify-center w-full px-6 py-3 text-base border border-t-0 border-gray-200 border-solid cursor-pointer text-primary-400 hover:bg-primary-100",onClick:b[1]||(b[1]=(...y)=>t.store.addItem&&t.store.addItem(...y))},[s(B,{name:"PlusCircleIcon",class:"mr-2"}),V(" "+_(w.$t("general.add_new_item")),1)])],64)}}},Ut={class:"flex items-center justify-between w-full mt-2 text-sm"},Nt={class:"font-semibold leading-5 text-gray-500 uppercase"},Et={class:"flex items-center justify-center text-lg text-black"},Ot={__name:"CreateTotalTaxes",props:{index:{type:Number,required:!0},tax:{type:Object,required:!0},taxes:{type:Array,required:!0},currency:{type:[Object,String],required:!0},store:{type:Object,default:null},data:{type:String,default:""}},emits:["update","remove"],setup(t,{emit:f}){const e=t,o=f;ne("$utils");const w=I(()=>e.tax.compound_tax&&e.store.getSubtotalWithDiscount?Math.round((e.store.getSubtotalWithDiscount+e.store.getTotalSimpleTax)*e.tax.percent/100):e.store.getSubtotalWithDiscount&&e.tax.percent?Math.round(e.store.getSubtotalWithDiscount*e.tax.percent/100):0);Ie(()=>{e.store.getSubtotalWithDiscount&&b(),e.store.getTotalSimpleTax&&b()});function b(){o("update",{...e.tax,amount:w.value})}return(c,S)=>{const B=x("BaseFormatMoney"),y=x("BaseIcon");return n(),$("div",Ut,[a("label",Nt,_(t.tax.name)+" ("+_(t.tax.percent)+" %) ",1),a("label",Et,[s(B,{amount:t.tax.amount,currency:t.currency},null,8,["amount","currency"]),s(y,{name:"TrashIcon",class:"h-5 ml-2 cursor-pointer",onClick:S[0]||(S[0]=A=>c.$emit("remove",t.tax.id))})])])}}},Lt={class:"w-full mt-4 tax-select"},zt={class:"relative w-full max-w-md px-4"},Ft={class:"overflow-hidden rounded-md shadow-lg ring-1 ring-black ring-opacity-5"},Rt={class:"relative bg-white"},Yt={class:"relative p-4"},Xt={key:0,class:"relative flex flex-col overflow-auto list max-h-36 border-t border-gray-200"},Qt=["onClick"],Wt={class:"flex justify-between px-2"},Jt={class:"m-0 text-base font-semibold leading-tight text-gray-700 cursor-pointer"},Gt={class:"m-0 text-base font-semibold text-gray-700 cursor-pointer"},Zt={key:1,class:"flex justify-center p-5 text-gray-400"},Ht={class:"text-base text-gray-500 cursor-pointer"},Kt={class:"m-0 ml-3 text-sm leading-none cursor-pointer font-base text-primary-400"},es={__name:"SelectTaxPopup",props:{type:{type:String,default:null},store:{type:Object,default:null},storeProp:{type:String,default:""}},emits:["select:taxType"],setup(t,{emit:f}){const e=t,o=f,w=Q(),b=H(),c=oe(),{t:S}=W(),B=Y(null),y=I(()=>B.value?b.taxTypes.filter(function(l){return l.name.toLowerCase().indexOf(B.value.toLowerCase())!==-1}):b.taxTypes),A=I(()=>e.store[e.storeProp].taxes);function D(l,u){o("select:taxType",{...l}),u()}function j(){w.openModal({title:S("settings.tax_types.add_tax"),componentName:"TaxTypeModal",size:"sm",refreshData:l=>o("select:taxType",l)})}return(l,u)=>{const d=x("BaseIcon"),m=x("BaseInput");return n(),$("div",Lt,[s(p(Ce),{class:"relative"},{default:i(({isOpen:g})=>[s(p(Te),{class:R([g?"":"text-opacity-90","flex items-center text-sm font-medium text-primary-400 focus:outline-none focus:border-none"])},{default:i(()=>[s(d,{name:"PlusIcon",class:"w-4 h-4 font-medium text-primary-400"}),V(" "+_(l.$t("settings.tax_types.add_tax")),1)]),_:2},1032,["class"]),a("div",zt,[s(ke,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:i(()=>[s(p(Pe),{style:{"min-width":"350px","margin-left":"62px",top:"-28px"},class:"absolute z-10 px-4 py-2 -translate-x-full sm:px-0"},{default:i(({close:h})=>[a("div",Ft,[a("div",Rt,[a("div",Yt,[s(m,{modelValue:B.value,"onUpdate:modelValue":u[0]||(u[0]=r=>B.value=r),placeholder:l.$t("general.search"),type:"text",class:"text-black"},null,8,["modelValue","placeholder"])]),y.value.length>0?(n(),$("div",Xt,[(n(!0),$(G,null,Z(y.value,(r,T)=>(n(),$("div",{key:T,class:R([{"bg-gray-100 cursor-not-allowed opacity-50 pointer-events-none":A.value.find(k=>k.tax_type_id===r.id)},"px-6 py-4 border-b border-gray-200 border-solid cursor-pointer hover:bg-gray-100 hover:cursor-pointer last:border-b-0"]),tabindex:"2",onClick:k=>D(r,h)},[a("div",Wt,[a("label",Jt,_(r.name),1),a("label",Gt,_(r.percent)+" % ",1)])],10,Qt))),128))])):(n(),$("div",Zt,[a("label",Ht,_(l.$t("general.no_tax_found")),1)]))]),p(c).hasAbilities(p(le).CREATE_TAX_TYPE)?(n(),$("button",{key:0,type:"button",class:"flex items-center justify-center w-full h-10 px-2 py-3 bg-gray-200 border-none outline-none",onClick:j},[s(d,{name:"CheckCircleIcon",class:"text-primary-400"}),a("label",Kt,_(l.$t("estimates.add_new_tax")),1)])):U("",!0)])]),_:1})]),_:1})])]),_:1})])}}},ts={class:"px-5 py-4 mt-6 bg-white border border-gray-200 border-solid rounded md:min-w-[390px] min-w-[300px] lg:mt-7"},ss={class:"flex items-center justify-between w-full"},as={key:1,class:"text-sm font-semibold leading-5 text-gray-400 uppercase"},os={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},ns={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-500 uppercase"},rs={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},ls={key:0,class:"flex items-center justify-between w-full mt-2"},is={key:1,class:"text-sm font-semibold leading-5 text-gray-400 uppercase"},ds={key:3,class:"flex",style:{width:"140px"},role:"group"},cs={class:"flex items-center"},us={key:1},ms={class:"flex items-center justify-between w-full pt-2 mt-5 border-t border-gray-200 border-solid"},ps={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-400 uppercase"},ys={key:3,class:"flex items-center justify-center text-lg uppercase text-primary-400"},zs={__name:"CreateTotal",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},taxPopupType:{type:String,default:""},currency:{type:[Object,String],default:""},isLoading:{type:Boolean,default:!1}},setup(t){const f=Y(null),e=t;ne("$utils");const o=K(),w=I({get:()=>e.store[e.storeProp].discount,set:l=>{e.store[e.storeProp].discount_type==="percentage"?e.store[e.storeProp].discount_val=Math.round(e.store.getSubTotal*l/100):e.store[e.storeProp].discount_val=Math.round(l*100),e.store[e.storeProp].discount=l}}),b=I({get:()=>e.store[e.storeProp].taxes,set:l=>{e.store.$patch(u=>{u[e.storeProp].taxes=l})}}),c=I(()=>{let l=[];return e.store[e.storeProp].items.forEach(u=>{u.taxes&&u.taxes.forEach(d=>{let m=l.find(g=>g.tax_type_id===d.tax_type_id);m?m.amount+=d.amount:d.tax_type_id&&l.push({tax_type_id:d.tax_type_id,amount:d.amount,percent:d.percent,name:d.name})})}),l}),S=I(()=>e.currency?e.currency:o.selectedCompanyCurrency);function B(){e.store[e.storeProp].discount_type!=="fixed"&&(e.store[e.storeProp].discount_val=Math.round(e.store[e.storeProp].discount*100),e.store[e.storeProp].discount_type="fixed")}function y(){e.store[e.storeProp].discount_type!=="percentage"&&(e.store[e.storeProp].discount_val=e.store.getSubTotal*e.store[e.storeProp].discount/100,e.store[e.storeProp].discount_type="percentage")}function A(l){let u=0;l.compound_tax&&e.store.getSubtotalWithDiscount?u=Math.round((e.store.getSubtotalWithDiscount+e.store.getTotalSimpleTax)*l.percent/100):e.store.getSubtotalWithDiscount&&l.percent&&(u=Math.round(e.store.getSubtotalWithDiscount*l.percent/100));let d={...le,id:xe.raw(),name:l.name,percent:l.percent,compound_tax:l.compound_tax,tax_type_id:l.id,amount:u};e.store.$patch(m=>{m[e.storeProp].taxes.push({...d})})}function D(l){const u=e.store[e.storeProp].taxes.find(d=>d.id===l.id);u&&Object.assign(u,{...l})}function j(l){const u=e.store[e.storeProp].taxes.findIndex(d=>d.id===l);e.store.$patch(d=>{d[e.storeProp].taxes.splice(u,1)})}return(l,u)=>{const d=x("BaseContentPlaceholdersText"),m=x("BaseContentPlaceholders"),g=x("BaseFormatMoney"),h=x("BaseInput"),r=x("BaseIcon"),T=x("BaseButton"),k=x("BaseDropdownItem"),O=x("BaseDropdown");return n(),$("div",ts,[a("div",ss,[t.isLoading?(n(),M(m,{key:0},{default:i(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):(n(),$("label",as,_(l.$t("estimates.sub_total")),1)),t.isLoading?(n(),M(m,{key:2},{default:i(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):(n(),$("label",os,[s(g,{amount:t.store.getSubTotal,currency:S.value},null,8,["amount","currency"])]))]),(n(!0),$(G,null,Z(c.value,P=>(n(),$("div",{key:P.tax_type_id,class:"flex items-center justify-between w-full"},[t.isLoading?(n(),M(m,{key:0},{default:i(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):t.store[t.storeProp].tax_per_item==="YES"?(n(),$("label",ns,_(P.name)+" - "+_(P.percent)+"% ",1)):U("",!0),t.isLoading?(n(),M(m,{key:2},{default:i(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):t.store[t.storeProp].tax_per_item==="YES"?(n(),$("label",rs,[s(g,{amount:P.amount,currency:S.value},null,8,["amount","currency"])])):U("",!0)]))),128)),t.store[t.storeProp].discount_per_item==="NO"||t.store[t.storeProp].discount_per_item===null?(n(),$("div",ls,[t.isLoading?(n(),M(m,{key:0},{default:i(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):(n(),$("label",is,_(l.$t("estimates.discount")),1)),t.isLoading?(n(),M(m,{key:2},{default:i(()=>[s(d,{lines:1,class:"w-24 h-8 border rounded-md"})]),_:1})):(n(),$("div",ds,[s(h,{modelValue:w.value,"onUpdate:modelValue":u[0]||(u[0]=P=>w.value=P),class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-br-sm h-[38px]"},null,8,["modelValue"]),s(O,{position:"bottom-end"},{activator:i(()=>[s(T,{class:"p-2 rounded-none rounded-tr-md rounded-br-md",type:"button",variant:"white"},{default:i(()=>[a("span",cs,[V(_(t.store[t.storeProp].discount_type=="fixed"?S.value.symbol:"%")+" ",1),s(r,{name:"ChevronDownIcon",class:"w-4 h-4 ml-1 text-gray-500"})])]),_:1})]),default:i(()=>[s(k,{onClick:B},{default:i(()=>[V(_(l.$t("general.fixed")),1)]),_:1}),s(k,{onClick:y},{default:i(()=>[V(_(l.$t("general.percentage")),1)]),_:1})]),_:1})]))])):U("",!0),t.store[t.storeProp].tax_per_item==="NO"||t.store[t.storeProp].tax_per_item===null?(n(),$("div",us,[(n(!0),$(G,null,Z(b.value,(P,q)=>(n(),M(Ot,{key:P.id,index:q,tax:P,taxes:b.value,currency:t.currency,store:t.store,onRemove:j,onUpdate:D},null,8,["index","tax","taxes","currency","store"]))),128))])):U("",!0),t.store[t.storeProp].tax_per_item==="NO"||t.store[t.storeProp].tax_per_item===null?(n(),$("div",{key:2,ref_key:"taxModal",ref:f,class:"float-right pt-2 pb-4"},[s(es,{"store-prop":t.storeProp,store:t.store,type:t.taxPopupType,"onSelect:taxType":A},null,8,["store-prop","store","type"])],512)):U("",!0),a("div",ms,[t.isLoading?(n(),M(m,{key:0},{default:i(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):(n(),$("label",ps,_(l.$t("estimates.total"))+" "+_(l.$t("estimates.amount"))+":",1)),t.isLoading?(n(),M(m,{key:2},{default:i(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):(n(),$("label",ys,[s(g,{amount:t.store.getTotal,currency:S.value},null,8,["amount","currency"])]))])])}}},xs={class:"flex text-gray-800 font-medium text-sm mb-2"},fs=a("span",{class:"text-sm text-red-500"}," *",-1),Fs={__name:"SelectTemplateButton",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},isMarkAsDefault:{type:Boolean,default:!1}},setup(t){const f=t,e=Q(),{t:o}=W();function w(){let b="";f.storeProp=="newEstimate"?b=o("estimates.mark_as_default_estimate_template_description"):f.storeProp=="newInvoice"&&(b=o("invoices.mark_as_default_invoice_template_description")),e.openModal({title:o("general.choose_template"),componentName:"SelectTemplate",data:{templates:f.store.templates,store:f.store,storeProp:f.storeProp,isMarkAsDefault:f.isMarkAsDefault,markAsDefaultDescription:b}})}return(b,c)=>{const S=x("BaseIcon"),B=x("BaseButton");return n(),$("div",null,[a("label",xs,[V(_(b.$t("general.select_template"))+" ",1),fs]),s(B,{type:"button",class:"flex justify-center w-full text-sm lg:w-auto hover:bg-gray-200",variant:"gray",onClick:w},{right:i(y=>[s(S,{name:"PencilIcon",class:R(y.class)},null,8,["class"])]),default:i(()=>[V(" "+_(t.store[t.storeProp].template_name),1)]),_:1})])}}},_s={class:"mb-6"},gs={class:"z-20 text-sm font-semibold leading-5 text-primary-400 float-right"},hs={class:"text-gray-800 font-medium mb-4 text-sm"},Rs={__name:"CreateNotesField",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},fields:{type:Object,default:null},type:{type:String,default:null}},setup(t){const f=t;function e(o){f.store[f.storeProp].notes=""+o.notes}return(o,w)=>{const b=x("BaseCustomInput");return n(),$("div",_s,[a("div",gs,[s(Ue,{type:t.type,onSelect:e},null,8,["type"])]),a("label",hs,_(o.$t("invoices.notes")),1),s(b,{modelValue:t.store[t.storeProp].notes,"onUpdate:modelValue":w[0]||(w[0]=c=>t.store[t.storeProp].notes=c),"content-loading":t.store.isFetchingInitialSettings,fields:t.fields,class:"mt-1"},null,8,["modelValue","content-loading","fields"])])}}},vs={class:"flex justify-between w-full"},bs={class:"px-8 py-8 sm:p-6"},$s={key:0,class:"grid grid-cols-3 gap-2 p-1 overflow-x-auto"},ws=["onClick"],Ss=["src","alt"],Bs=["alt","src"],Is={key:1,class:"z-0 flex ml-3 pt-5"},Ts={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Ys={__name:"SelectTemplateModal",setup(t){const f=Q(),e=oe(),o=Y(""),w=I(()=>f.active&&f.componentName==="SelectTemplate"),b=I(()=>f.title);function c(){f.data.store[f.data.storeProp].template_name?o.value=f.data.store[f.data.storeProp].template_name:o.value=f.data.templates[0]}async function S(){await f.data.store.setTemplate(o.value),!f.data.store.isEdit&&f.data.isMarkAsDefault&&(f.data.storeProp=="newEstimate"?await e.updateUserSettings({settings:{default_estimate_template:o.value}}):f.data.storeProp=="newInvoice"&&await e.updateUserSettings({settings:{default_invoice_template:o.value}})),y()}function B(){return new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACoAAAAqCAYAAADFw8lbAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANDSURBVHgB1ZnPTxNBFMe/b4AExUQSlXjRbDxoTEwsifEo5S9gjRrQg4onL0b+AUTkHwBP3tSLgfgjezDxyPoX0IOJxAtFb/6IvWAxyI7vTbtlC0vplN12+RzohN1hP7zZN515Q2gR113q70VvTqNrBCpwSCNHoH4N3S/XuV0KoIsElKD1R/6VP++d99EiBEvG3M95kVOk74ZSzT+MSprgbQYbc6+9CwW7vhaCIJriZh7J4HOkxznKxWZu3lNUhviQ6pvSOphAChCp2XKwNu15g6WG9zW6yFF0+C8tctNBuhQ5usONoqt2u3DL/ZLj/3YJ6UvCPIMDcsP9lNvthtiIiqQmvWibLPtFku2f3hiOS7Qdom0c7ljMzKCDwe2vQd3QS+J0UlIwo8gOxiVCnahkNzooGcGputSoDX11yFeQJSozgS/NrYgSPUfWqHzBVJryQ6aFLupeQhapRtVEtAs9D5FRNMiVTyNKBBdt4MrwUZwY6LHqo4juyAzQXVkNpT+xXxs9huujx/FnLcDM5FcUi3+b6iduspyUiOaRMqGkcLhPYXLmtE13M/yKx30IKRKVDPnw/jfsCBylgdSGPU7y7cIvvFn4CRt4cXRRcUgdWHL/wUk8fXamYWIkJSnIFkfZJtLtewMYqmbv5JNTsbJJSgriqGw7Xbp8pNaOk01aMkTJssqmw8yjb/jxfQNxsmlJiiONucsr3HJsOsZFUuZHmXqSlqyIoiBZb7VtFSSi2yOblqTAjiXOeqyiBeJkQ5KUNHABQ7LeQ4vEySYuWcFX61gv2CZUlKhsGpLiJss8sx696S7Pcqklm0s9ohfz786NmwzYz/CnjdSp5NOIVvclPrKHH+7xt+YUraeRNbiIFjZrouaF1ZhDRtDsEi1C1M3SZZQfQwpWnYfX/8alRp2oKf3xrm8/01UCmMre9jLkjtWThJs0dURWnqm0uhpXfoxd5r3yzhZEFm18DcwKiZ8pz46/3oADUcgVpOO6Lg+mORtIdssz9qrl2xw2ONX6VB7JIIcN080e6Vgf30g1OsDmBO8MR1o5vgm0fkn8lW175mQtGsUc6UiEuTYg227Z0UYPxLhdIqJCEOhVkZOV2l6nH7vxH+OylVHYXSZdAAAAAElFTkSuQmCC",self.location)}function y(){f.closeModal(),setTimeout(()=>{f.$reset()},300)}return(A,D)=>{const j=x("BaseIcon"),l=x("BaseCheckbox"),u=x("BaseButton"),d=x("BaseModal");return n(),M(d,{show:w.value,onClose:y,onOpen:c},{header:i(()=>[a("div",vs,[V(_(b.value)+" ",1),s(j,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:y})])]),default:i(()=>[a("div",bs,[p(f).data?(n(),$("div",$s,[(n(!0),$(G,null,Z(p(f).data.templates,(m,g)=>(n(),$("div",{key:g,class:R([{"border border-solid border-primary-500":o.value===m.name},"relative flex flex-col m-2 border border-gray-200 border-solid cursor-pointer hover:border-primary-300"]),onClick:h=>o.value=m.name},[a("img",{src:m.path,alt:m.name,class:"w-full min-h-[100px]"},null,8,Ss),o.value===m.name?(n(),$("img",{key:0,alt:m.name,class:"absolute z-10 w-5 h-5 text-primary-500",style:{top:"-6px",right:"-5px"},src:B()},null,8,Bs)):U("",!0),a("span",{class:R(["w-full p-1 bg-gray-200 text-sm text-center absolute bottom-0 left-0",{"text-primary-500 bg-primary-100":o.value===m.name,"text-gray-600":o.value!=m.name}])},_(m.name),3)],10,ws))),128))])):U("",!0),p(f).data.store.isEdit?U("",!0):(n(),$("div",Is,[s(l,{modelValue:p(f).data.isMarkAsDefault,"onUpdate:modelValue":D[0]||(D[0]=m=>p(f).data.isMarkAsDefault=m),"set-initial-value":!1,variant:"primary",label:A.$t("general.mark_as_default"),description:p(f).data.markAsDefaultDescription},null,8,["modelValue","label","description"])]))]),a("div",Ts,[s(u,{class:"mr-3",variant:"primary-outline",onClick:y},{default:i(()=>[V(_(A.$t("general.cancel")),1)]),_:1}),s(u,{variant:"primary",onClick:D[1]||(D[1]=m=>S())},{left:i(m=>[s(j,{name:"SaveIcon",class:R(m.class)},null,8,["class"])]),default:i(()=>[V(" "+_(A.$t("general.choose")),1)]),_:1})])]),_:1},8,["show"])}}},ks={class:"flex justify-between w-full"},Ps={class:"item-modal"},Cs={class:"px-8 py-8 sm:p-6"},Ms={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Xs={__name:"ItemModal",emits:["newItem"],setup(t,{emit:f}){const e=Q(),o=ye(),w=K(),b=H();Me(),Ae();const{t:c}=W(),S=Y(!1),B=Y(w.selectedCompanySettings.tax_per_item),y=I(()=>e.active&&e.componentName==="ItemModal"),A=I({get:()=>o.currentItem.price/100,set:h=>{o.currentItem.price=Math.round(h*100)}}),D=I({get:()=>o.currentItem.taxes.map(h=>{if(h)return{...h,tax_type_id:h.id,tax_name:h.name+" ("+h.percent+"%)"}}),set:h=>{o.$patch(r=>{r.currentItem.taxes=h})}}),j=I(()=>B.value==="YES"),l={name:{required:N.withMessage(c("validation.required"),F),minLength:N.withMessage(c("validation.name_min_length",{count:3}),De(3))},description:{maxLength:N.withMessage(c("validation.description_maxlength",{count:255}),ee(255))}},u=re(l,I(()=>o.currentItem)),d=I(()=>b.taxTypes.map(h=>({...h,tax_name:h.name+" ("+h.percent+"%)"})));fe(()=>{u.value.$reset(),o.fetchItemUnits({limit:"all"})});async function m(){if(u.value.$touch(),u.value.$invalid)return!0;let h={...o.currentItem,taxes:o.currentItem.taxes.map(T=>({tax_type_id:T.id,amount:A.value*T.percent/100,percent:T.percent,name:T.name,collective_tax:0}))};S.value=!0,await(o.isEdit?o.updateItem:o.addItem)(h).then(T=>{S.value=!1,T.data.data&&e.data&&e.refreshData(T.data.data),g()})}function g(){e.closeModal(),setTimeout(()=>{o.resetCurrentItem(),e.$reset(),u.value.$reset()},300)}return(h,r)=>{const T=x("BaseIcon"),k=x("BaseInput"),O=x("BaseInputGroup"),P=x("BaseMoney"),q=x("BaseMultiselect"),v=x("BaseTextarea"),C=x("BaseInputGrid"),L=x("BaseButton"),J=x("BaseModal");return n(),M(J,{show:y.value,onClose:g},{header:i(()=>[a("div",ks,[V(_(p(e).title)+" ",1),s(T,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:g})])]),default:i(()=>[a("div",Ps,[a("form",{action:"",onSubmit:_e(m,["prevent"])},[a("div",Cs,[s(C,{layout:"one-column"},{default:i(()=>[s(O,{label:h.$t("items.name"),required:"",error:p(u).name.$error&&p(u).name.$errors[0].$message},{default:i(()=>[s(k,{modelValue:p(o).currentItem.name,"onUpdate:modelValue":r[0]||(r[0]=E=>p(o).currentItem.name=E),type:"text",invalid:p(u).name.$error,onInput:r[1]||(r[1]=E=>p(u).name.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),s(O,{label:h.$t("items.price")},{default:i(()=>[(n(),M(P,{key:p(w).selectedCompanyCurrency,modelValue:A.value,"onUpdate:modelValue":r[2]||(r[2]=E=>A.value=E),currency:p(w).selectedCompanyCurrency,class:"relative w-full focus:border focus:border-solid focus:border-primary"},null,8,["modelValue","currency"]))]),_:1},8,["label"]),s(O,{label:h.$t("items.unit")},{default:i(()=>[s(q,{modelValue:p(o).currentItem.unit_id,"onUpdate:modelValue":r[3]||(r[3]=E=>p(o).currentItem.unit_id=E),label:"name",options:p(o).itemUnits,"value-prop":"id","can-deselect":!1,"can-clear":!1,placeholder:h.$t("items.select_a_unit"),searchable:"","track-by":"name"},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),j.value?(n(),M(O,{key:0,label:h.$t("items.taxes")},{default:i(()=>[s(q,{modelValue:D.value,"onUpdate:modelValue":r[4]||(r[4]=E=>D.value=E),options:d.value,mode:"tags",label:"tax_name","value-prop":"id",class:"w-full","can-deselect":!1,"can-clear":!1,searchable:"","track-by":"tax_name",object:""},null,8,["modelValue","options"])]),_:1},8,["label"])):U("",!0),s(O,{label:h.$t("items.description"),error:p(u).description.$error&&p(u).description.$errors[0].$message},{default:i(()=>[s(v,{modelValue:p(o).currentItem.description,"onUpdate:modelValue":r[5]||(r[5]=E=>p(o).currentItem.description=E),rows:"4",cols:"50",invalid:p(u).description.$error,onInput:r[6]||(r[6]=E=>p(u).description.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"])]),_:1})]),a("div",Ms,[s(L,{class:"mr-3",variant:"primary-outline",type:"button",onClick:g},{default:i(()=>[V(_(h.$t("general.cancel")),1)]),_:1}),s(L,{loading:S.value,disabled:S.value,variant:"primary",type:"submit"},{left:i(E=>[s(T,{name:"SaveIcon",class:R(E.class)},null,8,["class"])]),default:i(()=>[V(" "+_(p(o).isEdit?h.$t("general.update"):h.$t("general.save")),1)]),_:1},8,["loading","disabled"])])],32)])]),_:1},8,["show"])}}},As={class:"flex justify-between w-full"},Ds={class:"flex flex-col"},Vs={class:"text-sm text-gray-500 mt-1"},js={class:"p-4 sm:p-6"},qs={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Us={__name:"TaxationAddressModal",emits:["addTax"],setup(t,{emit:f}){const e=Q();Ve();const o=pe({state:"",city:"",address_street_1:"",zip:""}),w=Y(!1),b=H(),{t:c}=W(),S=I(()=>e.active&&e.componentName==="TaxationAddressModal"),B=I(()=>({state:{required:N.withMessage(c("validation.required"),F)},city:{required:N.withMessage(c("validation.required"),F)},address_street_1:{required:N.withMessage(c("validation.required"),F)},zip:{required:N.withMessage(c("validation.required"),F)}})),y=re(B,I(()=>o));async function A(){if(y.value.$touch(),y.value.$invalid)return!0;let u={address:o};e.id&&(u.customer_id=e.id),o.address_street_1=o.address_street_1.replace(/(\r\n|\n|\r)/gm,""),w.value=!0,await b.fetchSalesTax(u).then(d=>{w.value=!1,D("addTax",d.data.data),l()}).catch(d=>{w.value=!1})}const D=f;function j(){o.state=e?.data?.state,o.city=e?.data?.city,o.address_street_1=e?.data?.address_street_1,o.zip=e?.data?.zip}function l(){e.closeModal()}return(u,d)=>{const m=x("BaseIcon"),g=x("BaseInput"),h=x("BaseInputGroup"),r=x("BaseTextarea"),T=x("BaseInputGrid"),k=x("BaseButton"),O=x("BaseModal");return n(),M(O,{show:S.value,onClose:l,onOpen:j},{header:i(()=>[a("div",As,[a("div",Ds,[V(_(p(e).title)+" ",1),a("p",Vs,_(p(e).content),1)]),s(m,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:l})])]),default:i(()=>[a("form",{onSubmit:_e(A,["prevent"])},[a("div",js,[s(T,{layout:"one-column"},{default:i(()=>[s(h,{required:"",error:p(y).state.$error&&p(y).state.$errors[0].$message,label:u.$t("customers.state")},{default:i(()=>[s(g,{modelValue:o.state,"onUpdate:modelValue":d[0]||(d[0]=P=>o.state=P),type:"text",name:"shippingState",class:"mt-1 md:mt-0",invalid:p(y).state.$error,onInput:d[1]||(d[1]=P=>p(y).state.$touch()),placeholder:u.$t("settings.taxations.state_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),s(h,{required:"",error:p(y).city.$error&&p(y).city.$errors[0].$message,label:u.$t("customers.city")},{default:i(()=>[s(g,{modelValue:o.city,"onUpdate:modelValue":d[2]||(d[2]=P=>o.city=P),type:"text",name:"shippingCity",class:"mt-1 md:mt-0",invalid:p(y).city.$error,onInput:d[3]||(d[3]=P=>p(y).city.$touch()),placeholder:u.$t("settings.taxations.city_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),s(h,{required:"",error:p(y).address_street_1.$error&&p(y).address_street_1.$errors[0].$message,label:u.$t("customers.address")},{default:i(()=>[s(r,{modelValue:o.address_street_1,"onUpdate:modelValue":d[4]||(d[4]=P=>o.address_street_1=P),rows:"2",cols:"50",class:"mt-1 md:mt-0",invalid:p(y).address_street_1.$error,onInput:d[5]||(d[5]=P=>p(y).address_street_1.$touch()),placeholder:u.$t("settings.taxations.address_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),s(h,{required:"",error:p(y).zip.$error&&p(y).zip.$errors[0].$message,label:u.$t("customers.zip_code")},{default:i(()=>[s(g,{modelValue:o.zip,"onUpdate:modelValue":d[6]||(d[6]=P=>o.zip=P),invalid:p(y).zip.$error,onInput:d[7]||(d[7]=P=>p(y).zip.$touch()),type:"text",class:"mt-1 md:mt-0",placeholder:u.$t("settings.taxations.zip_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"])]),_:1})]),a("div",qs,[s(k,{class:"mr-3 text-sm",type:"button",variant:"primary-outline",onClick:l},{default:i(()=>[V(_(u.$t("general.cancel")),1)]),_:1}),s(k,{loading:w.value,variant:"primary",type:"submit"},{left:i(P=>[w.value?U("",!0):(n(),M(m,{key:0,name:"SaveIcon",class:R(P.class)},null,8,["class"]))]),default:i(()=>[V(" "+_(u.$t("general.save")),1)]),_:1},8,["loading"])])],32)]),_:1},8,["show"])}}},te="Sales Tax",se="MODULE",Qs={__name:"SalesTax",props:{isEdit:{type:Boolean,default:null},type:{type:String,default:null},customer:{type:[Object],default:null},store:{type:Object,default:null},storeProp:{type:String,default:null}},setup(t){const f=Q(),e=K(),o=H(),{t:w}=W(),b=Y(!1),c=t,S=I(()=>c.isEdit?c.store[c.storeProp].sales_tax_address_type==="billing":e.selectedCompanySettings.sales_tax_address_type==="billing"),B=I(()=>e.selectedCompanySettings.sales_tax_us_enabled==="YES"),y=I(()=>c.isEdit?c.store[c.storeProp].sales_tax_type==="customer_level":e.selectedCompanySettings.sales_tax_type==="customer_level"),A=I(()=>c.isEdit?c.store[c.storeProp].sales_tax_type==="company_level":e.selectedCompanySettings.sales_tax_type==="company_level"),D=I(()=>{if(y.value&&j.value){let r=S.value?c.customer.billing:c.customer.shipping;return{address:X.exports.pick(r,["address_street_1","city","state","zip"]),customer_id:c.customer.id}}else if(A.value&&j.value)return{address:X.exports.pick(address,["address_street_1","city","state","zip"])}}),j=I(()=>{if(y.value){let r=S.value?c.customer?.billing:c.customer?.shipping;return l(r)}else if(A.value)return l(e.selectedCompany.address);return!1});ae(()=>c.customer,(r,T)=>{if(r&&T&&y.value){u(r,T);return}!j.value&&y.value&&r?setTimeout(()=>{d()},500):y.value&&r?m():y.value&&!r&&h()}),fe(()=>{A.value&&(j.value?m():d())});function l(r){return r?r.address_street_1&&r.city&&r.state&&r.zip:!1}function u(r,T){const k=S.value?r.billing:r.shipping,O=S.value?T.billing:T.shipping,P=X.exports.pick(k,["address_street_1","city","state","zip"]),q=X.exports.pick(O,["address_street_1","city","state","zip"]);X.exports.isEqual(P,q)||m()}function d(){if(!B.value)return;let r=null,T="";y.value?S.value?(r=c.customer?.billing,T=w("settings.taxations.add_billing_address")):(r=c.customer?.shipping,T=w("settings.taxations.add_shipping_address")):(r=e.selectedCompany.address,T=w("settings.taxations.add_company_address")),f.openModal({title:T,content:w("settings.taxations.modal_description"),componentName:"TaxationAddressModal",data:r,id:y.value?c.customer.id:""})}async function m(){!B.value||(b.value=!0,await o.fetchSalesTax(D.value).then(r=>{g(r.data.data),b.value=!1}).catch(r=>{r.response.data.error&&setTimeout(()=>{d()},500),b.value=!1}))}function g(r){r.tax_type_id=r.id;const T=c.store[c.storeProp].taxes.findIndex(k=>k.name===te&&k.type===se);T>-1?Object.assign(c.store[c.storeProp].taxes[T],r):c.store[c.storeProp].taxes.push(r)}function h(){const r=c.store[c.storeProp].taxes.findIndex(k=>k.name===te&&k.type===se);r>-1&&c.store[c.storeProp].taxes.splice(r,1);let T=o.taxTypes.findIndex(k=>k.name===te&&k.type===se);T>-1&&o.taxTypes.splice(T,1)}return(r,T)=>(n(),M(Us,{onAddTax:g}))}};export{Ys as _,Xs as a,Qs as b,Ls as c,Rs as d,Fs as e,zs as f};
