import{aO as T,l as O,M as j,d as I,K as X,e as C,P as Y,r as s,o as d,c as k,b as p,a as t,h as a,t as b,j as f,F as z,i as Z,z as V,n as ee,g as B,a5 as te,m as P,N as H,a6 as ne,x as r,R as S,E as ae,aa as oe}from"./main.f7d24694.js";import{L as re}from"./LoadingIcon.ac50fe1e.js";import{_ as se}from"./InvoiceIndexDropdown.c6a0d2ae.js";import{_ as ie}from"./SendInvoiceModal.8a0b5884.js";import{_ as le}from"./RecurringInvoiceIndexDropdown.12485b29.js";import"./mail-driver.0717a3d5.js";const ce={class:"fixed top-0 left-0 hidden h-full pt-16 pb-[6.4rem] ml-56 bg-white xl:ml-64 w-88 xl:block"},ue={class:"flex items-center justify-between px-4 pt-8 pb-2 border border-gray-200 border-solid height-full"},de={class:"mb-6"},me={class:"flex mb-6 ml-3",role:"group","aria-label":"First group"},_e={class:"px-2 py-1 pb-2 mb-1 mb-2 text-sm border-b border-gray-200 border-solid"},ve={class:"flex-2"},ge={class:"mt-1 mb-2 text-xs not-italic font-medium leading-5 text-gray-600"},pe={class:"flex-1 whitespace-nowrap right"},fe={class:"text-sm not-italic font-normal leading-5 text-right text-gray-600 est-date"},ye={key:0,class:"flex justify-center p-4 items-center"},be={key:1,class:"flex justify-center px-4 mt-5 text-sm text-gray-600"},Ie={__name:"RecurringInvoiceViewSidebar",setup(D){const n=T();O();const _=j(),o=I(!1),m=I(null),u=I(1),h=I(1),y=I(null),e=X({orderBy:null,orderByField:null,searchText:null}),x=C(()=>e.orderBy==="asc"||e.orderBy==null);function w(i){return _.params.id==i}async function R(i,v=!1){if(o.value)return;let g={};e.searchText!==""&&e.searchText!==null&&e.searchText!==void 0&&(g.search=e.searchText),e.orderBy!==null&&e.orderBy!==void 0&&(g.orderBy=e.orderBy),e.orderByField!==null&&e.orderByField!==void 0&&(g.orderByField=e.orderByField),o.value=!0;let $=await n.fetchRecurringInvoices({page:i,...g});o.value=!1,m.value=m.value?m.value:[],m.value=[...m.value,...$.data.data],u.value=i||1,h.value=$.data.meta.last_page;let E=m.value.find(F=>F.id==_.params.id);v==!1&&!E&&u.value<h.value&&Object.keys(g).length===0&&R(++u.value),E&&setTimeout(()=>{v==!1&&N()},500)}function N(){const i=document.getElementById(`recurring-invoice-${_.params.id}`);i&&(i.scrollIntoView({behavior:"smooth"}),i.classList.add("shake"),L())}function L(){y.value.addEventListener("scroll",i=>{i.target.scrollTop>0&&i.target.scrollTop+i.target.clientHeight>i.target.scrollHeight-200&&u.value<h.value&&R(++u.value,!0)})}async function l(){m.value=[],R()}function M(){return e.orderBy==="asc"?(e.orderBy="desc",l(),!0):(e.orderBy="asc",l(),!0)}return R(),l=Y.exports.debounce(l,500),(i,v)=>{const g=s("BaseIcon"),$=s("BaseInput"),E=s("BaseButton"),F=s("BaseRadio"),A=s("BaseInputGroup"),U=s("BaseDropdownItem"),G=s("BaseDropdown"),q=s("BaseText"),K=s("BaseRecurringInvoiceStatusBadge"),W=s("BaseFormatMoney"),J=s("router-link");return d(),k("div",ce,[p("div",ue,[p("div",de,[t($,{modelValue:e.searchText,"onUpdate:modelValue":v[0]||(v[0]=c=>e.searchText=c),placeholder:i.$t("general.search"),type:"text",variant:"gray",onInput:v[1]||(v[1]=c=>l())},{right:a(()=>[t(g,{name:"SearchIcon",class:"h-5 text-gray-400"})]),_:1},8,["modelValue","placeholder"])]),p("div",me,[t(G,{class:"ml-3",position:"bottom-start"},{activator:a(()=>[t(E,{size:"md",variant:"gray"},{default:a(()=>[t(g,{name:"FilterIcon",class:"h-5"})]),_:1})]),default:a(()=>[p("div",_e,b(i.$t("general.sort_by")),1),t(U,{class:"flex px-1 py-2 cursor-pointer"},{default:a(()=>[t(A,{class:"-mt-3 font-normal"},{default:a(()=>[t(F,{id:"filter_next_invoice_date",modelValue:e.orderByField,"onUpdate:modelValue":[v[2]||(v[2]=c=>e.orderByField=c),l],label:i.$t("recurring_invoices.next_invoice_date"),size:"sm",name:"filter",value:"next_invoice_at"},null,8,["modelValue","label"])]),_:1})]),_:1}),t(U,{class:"flex px-1 py-2 cursor-pointer"},{default:a(()=>[t(A,{class:"-mt-3 font-normal"},{default:a(()=>[t(F,{id:"filter_start_date",modelValue:e.orderByField,"onUpdate:modelValue":[v[3]||(v[3]=c=>e.orderByField=c),l],label:i.$t("recurring_invoices.starts_at"),value:"starts_at",size:"sm",name:"filter"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),t(E,{class:"ml-1",size:"md",variant:"gray",onClick:M},{default:a(()=>[x.value?(d(),f(g,{key:0,name:"SortAscendingIcon",class:"h-5"})):(d(),f(g,{key:1,name:"SortDescendingIcon",class:"h-5"}))]),_:1})])]),p("div",{ref_key:"invoiceListSection",ref:y,class:"h-full overflow-y-scroll border-l border-gray-200 border-solid base-scroll"},[(d(!0),k(z,null,Z(m.value,(c,Q)=>(d(),k("div",{key:Q},[c?(d(),f(J,{key:0,id:"recurring-invoice-"+c.id,to:`/admin/recurring-invoices/${c.id}/view`,class:ee(["flex justify-between side-invoice p-4 cursor-pointer hover:bg-gray-100 items-center border-l-4 border-transparent",{"bg-gray-100 border-l-4 border-primary-500 border-solid":w(c.id)}]),style:{"border-bottom":"1px solid rgba(185, 193, 209, 0.41)"}},{default:a(()=>[p("div",ve,[t(q,{text:c.customer.name,length:30,class:"pr-2 mb-2 text-sm not-italic font-normal leading-5 text-black capitalize truncate"},null,8,["text"]),p("div",ge,b(c.invoice_number),1),t(K,{status:c.status,class:"px-1 text-xs"},{default:a(()=>[V(b(c.status),1)]),_:2},1032,["status"])]),p("div",pe,[t(W,{class:"block mb-2 text-xl not-italic font-semibold leading-8 text-right text-gray-900",amount:c.total,currency:c.customer.currency},null,8,["amount","currency"]),p("div",fe,b(c.formatted_starts_at),1)])]),_:2},1032,["id","to","class"])):B("",!0)]))),128)),o.value?(d(),k("div",ye,[t(re,{class:"h-6 m-1 animate-spin text-primary-400"})])):B("",!0),!m.value?.length&&!o.value?(d(),k("p",be,b(i.$t("invoices.no_matching_invoices")),1)):B("",!0)],512)])}}},Be={class:"relative table-container"},he={__name:"Invoices",setup(D){const n=T(),_=I(null);I(null),te("$utils");const{t:o}=O();I(null),P();const m=H(),u=C(()=>[{key:"invoice_date",label:o("invoices.date"),thClass:"extra",tdClass:"font-medium text-gray-900"},{key:"invoice_number",label:o("invoices.invoice")},{key:"customer.name",label:o("invoices.customer")},{key:"status",label:o("invoices.status")},{key:"total",label:o("invoices.total")},{key:"actions",label:o("invoices.action"),tdClass:"text-right text-sm font-medium",thClass:"text-right",sortable:!1}]);function h(){return m.hasAbilities([S.DELETE_INVOICE,S.EDIT_INVOICE,S.VIEW_INVOICE,S.SEND_INVOICE])}function y(e){let x=n.newRecurringInvoice.invoices.findIndex(w=>w.id===e);n.newRecurringInvoice.invoices[x]&&(n.newRecurringInvoice.invoices[x].status="SENT")}return(e,x)=>{const w=s("router-link"),R=s("BaseFormatMoney"),N=s("BaseInvoiceStatusBadge"),L=s("BaseTable");return d(),k(z,null,[t(ie,{onUpdate:y}),p("div",Be,[t(L,{ref_key:"table",ref:_,data:r(n).newRecurringInvoice.invoices,columns:u.value,loading:r(n).isFetchingViewData,"placeholder-count":5,class:"mt-5"},ne({"cell-invoice_number":a(({row:l})=>[t(w,{to:{path:`/admin/invoices/${l.data.id}/view`},class:"font-medium text-primary-500"},{default:a(()=>[V(b(l.data.invoice_number),1)]),_:2},1032,["to"])]),"cell-total":a(({row:l})=>[t(R,{amount:l.data.due_amount,currency:l.data.currency},null,8,["amount","currency"])]),"cell-status":a(({row:l})=>[t(N,{status:l.data.status,class:"px-3 py-1"},{default:a(()=>[V(b(l.data.status),1)]),_:2},1032,["status"])]),_:2},[h()?{name:"cell-actions",fn:a(({row:l})=>[t(se,{row:l.data,table:_.value},null,8,["row","table"])]),key:"0"}:void 0]),1032,["data","columns","loading"])])],64)}}},xe={__name:"RecurringInvoiceInfo",setup(D){const n=T(),_=j();let o=C(()=>n.isFetchingViewData);ae(_,()=>{_.params.id&&_.name==="recurring-invoices.view"&&m()},{immediate:!0});async function m(){await n.fetchRecurringInvoice(_.params.id)}return(u,h)=>{const y=s("BaseHeading"),e=s("BaseDescriptionListItem"),x=s("BaseDescriptionList"),w=s("BaseCard");return d(),f(w,{class:"mt-10"},{default:a(()=>[t(y,null,{default:a(()=>[V(b(u.$t("customers.basic_info")),1)]),_:1}),t(x,{class:"mt-5"},{default:a(()=>[t(e,{label:u.$t("recurring_invoices.starts_at"),"content-loading":r(o),value:r(n).newRecurringInvoice?.formatted_starts_at},null,8,["label","content-loading","value"]),t(e,{label:u.$t("recurring_invoices.next_invoice_date"),"content-loading":r(o),value:r(n).newRecurringInvoice?.formatted_next_invoice_at},null,8,["label","content-loading","value"]),r(n).newRecurringInvoice?.limit_date&&r(n).newRecurringInvoice?.limit_by!=="NONE"?(d(),f(e,{key:0,label:u.$t("recurring_invoices.limit_date"),"content-loading":r(o),value:r(n).newRecurringInvoice?.limit_date},null,8,["label","content-loading","value"])):B("",!0),r(n).newRecurringInvoice?.limit_date&&r(n).newRecurringInvoice?.limit_by!=="NONE"?(d(),f(e,{key:1,label:u.$t("recurring_invoices.limit_by"),"content-loading":r(o),value:r(n).newRecurringInvoice?.limit_by},null,8,["label","content-loading","value"])):B("",!0),r(n).newRecurringInvoice?.limit_count?(d(),f(e,{key:2,label:u.$t("recurring_invoices.limit_count"),value:r(n).newRecurringInvoice?.limit_count,"content-loading":r(o)},null,8,["label","value","content-loading"])):B("",!0),r(n).newRecurringInvoice?.selectedFrequency?(d(),f(e,{key:3,label:u.$t("recurring_invoices.frequency.title"),value:r(n).newRecurringInvoice?.selectedFrequency?.label,"content-loading":r(o)},null,8,["label","value","content-loading"])):B("",!0)]),_:1}),t(y,{class:"mt-8"},{default:a(()=>[V(b(u.$t("invoices.title",2)),1)]),_:1}),t(he)]),_:1})}}},$e={__name:"View",setup(D){oe();const n=T(),_=H();O(),P();const o=C(()=>n.newRecurringInvoice?n.newRecurringInvoice?.customer?.name:"");function m(){return _.hasAbilities([S.DELETE_RECURRING_INVOICE,S.EDIT_RECURRING_INVOICE])}return(u,h)=>{const y=s("BasePageHeader"),e=s("BasePage");return d(),f(e,{class:"xl:pl-96"},{default:a(()=>[t(y,{title:o.value},{actions:a(()=>[m()?(d(),f(le,{key:0,row:r(n).newRecurringInvoice},null,8,["row"])):B("",!0)]),_:1},8,["title"]),t(Ie),t(xe)]),_:1})}}};export{$e as default};
